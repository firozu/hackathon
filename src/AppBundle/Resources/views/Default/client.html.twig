<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript">
function WebSocketTest(gameId, playerId)
{
  if (!("WebSocket" in window)) {
      alert ("AHH websocket not supported");

      return;
  }
     // Let us open a web socket
     window.ws = new WebSocket("ws://"+ window.location.hostname +":8085/");
     window.gameId = gameId;
     ws.onopen = function()
     {
        // Web Socket is connected, setup game()
        ws.send(JSON.stringify({'game': gameId, 'mobile': true, 'playerId' : playerId}));
     };
     ws.onmessage = function (evt)
     {
        var message = evt.data;
     };
     ws.onclose = function()
     {
        // websocket is closed go back to game connect
        window.ws = null;
        alert('socket closed');
     };
}

function sendit(event) {
    var toGo = {};
    if (
        event.accelerationIncludingGravity &&
        event.accelerationIncludingGravity.x !== null
    ) {
        toGo.x = Math.round(event.accelerationIncludingGravity.x * 1000) / 1000;
        toGo.y = Math.round(event.accelerationIncludingGravity.y * 1000) / 1000;
        toGo.z = Math.round(event.accelerationIncludingGravity.z * 1000) / 1000;
    }
    if (
        event.rotationRate &&
        event.rotationRate.alpha !== null
    ) {
        toGo.a = Math.round(event.rotationRate.alpha * 1000) / 1000;
        toGo.b = Math.round(event.rotationRate.beta * 1000) / 1000;
        toGo.g = Math.round(event.rotationRate.gamma * 1000) / 1000;
    }
    if (event.alpha &&
        event.alpha !== null
    ) {

        toGo.a = Math.round(event.alpha * 1000) / 1000;
        toGo.b = Math.round(event.beta * 1000) / 1000;
        toGo.g = Math.round(event.gamma * 1000) / 1000;
    }
    if (!window.ws) {
        return;
    }

    ws.send(JSON.stringify(toGo));
}

if (window.DeviceOrientationEvent) {
    window.addEventListener("deviceorientation", sendit, true);
} else if (window.DeviceMotionEvent) {
    window.addEventListener('devicemotion', sendit, true);
} else {
    alert('Phone did not bind to a gyro  event');
}

window.addEventListener('load' , function() {
    WebSocketTest('{{ gameId }}', {{ playerId }});
});

function closeWs()
{
    ws.close();
}
</script>
    </head>
    <body>
        <h3>Hello and welcom to Team Nismo hackathon project mobile client!</h3>
        <p>You will now be connected to game {{ gameId }}</p>
        <div id="sse">
            <a href="javascript:WebSocketTest('{{ gameId }}', {{ playerId }})">Run WebSocket</a>
            <a href="javascript:closeWs()">Close Websocket</a>
        </div>

    </body>
</html>
